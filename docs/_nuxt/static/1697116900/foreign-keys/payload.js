__NUXT_JSONP__("/foreign-keys", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){return {data:[{page:{slug:p,description:"Проверь порядок миграций и типы полей у внешнего ключа",heading:"Cannot add foreign key",altHeadings:null,toc:[],body:{type:q,children:[{type:b,tag:j,props:{heading:r,id:s},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:t}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,f]},children:[{type:a,value:u}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,f]},children:[{type:a,value:l}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,f]},children:[{type:a,value:m}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,f]},children:[{type:a,value:n}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,f]},children:[{type:a,value:o}]},{type:a,value:g}]},{type:a,value:g},{type:a,value:g},{type:b,tag:d,props:{},children:[{type:a,value:"\n  Все требования к механизму внешних ключей можно найти в\n  "},{type:b,tag:"external-link",props:{title:"документации",link:"https:\u002F\u002Fdev.mysql.com\u002Fdoc\u002Frefman\u002F8.0\u002Fen\u002Fcreate-table-foreign-keys.html"},children:[]},{type:a,value:c},{type:b,tag:"br",props:{},children:[]},{type:a,value:"Далее рассмотрим самые популярные причины.\n"}]},{type:a,value:g},{type:b,tag:j,props:{heading:"Разные типы полей",id:"diff-type"},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"\n    Столбцы должно быть одного типа,\n    а для "},{type:b,tag:h,props:{className:[i]},children:[{type:a,value:"INTEGER"}]},{type:a,value:" или "},{type:b,tag:h,props:{className:[i]},children:[{type:a,value:"DECIMAL"}]},{type:a,value:"\n    ещё и одного размера.\n  "}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,f]},children:[{type:a,value:l}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"\n    Обычно внешний ключ ссылается на ID другой таблицы и по умолчанию тип ID:\n    "},{type:b,tag:h,props:{className:[i]},children:[{type:a,value:"UNSIGNED BIG INTEGER"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:v,props:{name:"cases\u002Fforeign-keys\u002Fmigration-old"},children:[]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"\n    Или начиная с 7 версии более лаконичный синтаксис, который создаёт колонку и ключ:\n  "}]},{type:a,value:c},{type:b,tag:v,props:{name:"cases\u002Fforeign-keys\u002Fmigration-new"},children:[]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"\n    "},{type:b,tag:"b",props:{},children:[{type:a,value:"Обрати внимание"}]},{type:a,value:", что в старых версиях по умолчанию тип ID был "},{type:b,tag:h,props:{className:[i]},children:[{type:a,value:"UNSIGNED INTEGER"}]},{type:a,value:c}]},{type:a,value:g}]},{type:a,value:g},{type:b,tag:j,props:{heading:"Порядок миграций",id:"order"},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"\n    Логично, что прежде чем ссылаться на таблицу она уже должна быть создана,\n    тем не менее это часто упускается из виду и сначала создаётся \"дочерняя\" таблица.\n  "}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,f]},children:[{type:a,value:m}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"\n    Не всегда ошибка говорит, что не так и может быть общей: "},{type:b,tag:h,props:{className:[i]},children:[{type:a,value:"Cannot add foreign key constraint"}]},{type:a,value:c}]},{type:a,value:g}]},{type:a,value:g},{type:b,tag:j,props:{heading:"Данные в таблице",id:"data-already"},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"\n    Таблица уже содержит невалидные значения. Вариант часто встречается, \n    когда внешний ключ добавляется на уже созданную таблицу в которой есть данные.\n  "}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,f]},children:[{type:a,value:o}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"\n    Ошибка говорит о том, что нельзя добавить ключ, т.к. данные не консистентные.\n    Проблему необходимо устранить вручную установив правильные значения или "},{type:b,tag:h,props:{className:[i]},children:[{type:a,value:"NULL"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"\n    Ещё один вариант происходит при откате миграций:\n  "}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,f]},children:[{type:a,value:n}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"\n    Причина часто в нарушенном порядке миграций или проблемах в "},{type:b,tag:h,props:{className:[i,"code"]},children:[{type:a,value:"down()"}]},{type:a,value:".\n    Если ошибка происходит при "},{type:b,tag:h,props:{className:[i]},children:[{type:a,value:"php artisan migrate:fresh"}]},{type:a,value:", то необходимо вручную удалять\n    таблицы или данные в них.\n  "}]},{type:a,value:g}]},{type:a,value:g},{type:b,tag:j,props:{heading:"Движок таблиц",id:"engine"},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"\n    Родительская таблица не InnoDB. MyISAM не поддерживает внешние ключи.\n  "}]},{type:a,value:g}]}]},excerpt:{type:q,children:[{type:b,tag:j,props:{heading:r,id:s},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:t}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,f]},children:[{type:a,value:u}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,f]},children:[{type:a,value:l}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,f]},children:[{type:a,value:m}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,f]},children:[{type:a,value:n}]},{type:a,value:c},{type:b,tag:d,props:{className:[e,f]},children:[{type:a,value:o}]},{type:a,value:g}]}]},dir:"\u002Fcases",path:"\u002Fcases\u002Fforeign-keys",extension:".md",createdAt:"2022-08-15T13:41:49.936Z",updatedAt:"2022-08-15T19:05:35.578Z"},id:p}],fetch:{"CodeChips:0":{_error:{message:"request to http:\u002F\u002Flocalhost:3000\u002F_content\u002Fcode-chips\u002Fout\u002Fcases\u002Fforeign-keys\u002Fmigration-old.md failed, reason: connect ECONNREFUSED 127.0.0.1:3000",type:w,errno:k,code:k,statusCode:x}},"CodeChips:1":{_error:{message:"request to http:\u002F\u002Flocalhost:3000\u002F_content\u002Fcode-chips\u002Fout\u002Fcases\u002Fforeign-keys\u002Fmigration-new.md failed, reason: connect ECONNREFUSED 127.0.0.1:3000",type:w,errno:k,code:k,statusCode:x}}},mutations:[]}}("text","element","\n  ","p","console","log","\n","span","bit","case-context-section","ECONNREFUSED","\n    General error: 3780 Referencing column 'post_id' and referenced column 'id' in foreign key constraint 'xxx' are incompatible\n  ","\n    General error: 1824 Failed to open the referenced table\n  ","\n    General error: 3730 Cannot drop table 'xxx' referenced by a foreign key constraint\n  ","\n    SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails\n  ","foreign-keys","root","Проблема","problem","\n    Попытка добавить внешний ключ к таблице приводит к одной из ошибок:\n  ","\n    General error: 1215 Cannot add foreign key constraint \n  ","code-chips","system",500)));